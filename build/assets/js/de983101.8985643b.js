"use strict";(self.webpackChunkomm_docs=self.webpackChunkomm_docs||[]).push([[938],{3386:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var i=n(5893),r=n(1151);const a={id:"icx-delegation-script",title:"ICX delegation script",description:"Learn how ICON validators can use the ICX delegation script to track the votes they receive through Omm.",slug:"/icx-delegation-script",sidebar_position:5},c="ICX delegation script",s={id:"reference/icx-delegation-script",title:"ICX delegation script",description:"Learn how ICON validators can use the ICX delegation script to track the votes they receive through Omm.",source:"@site/docs/reference/icx-delegation-script.md",sourceDirName:"reference",slug:"/icx-delegation-script",permalink:"/icx-delegation-script",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"icx-delegation-script",title:"ICX delegation script",description:"Learn how ICON validators can use the ICX delegation script to track the votes they receive through Omm.",slug:"/icx-delegation-script",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Smart contracts",permalink:"/smart-contracts"},next:{title:"Testnet app",permalink:"/testnet"}},o={},d=[{value:"Run the ICX delegation script",id:"run-the-icx-delegation-script",level:2},{value:"Verify the votes",id:"verify-the-votes",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"icx-delegation-script",children:"ICX delegation script"}),"\n",(0,i.jsx)(t.p,{children:"Learn how ICON validators can use the ICX delegation script to track the votes they receive through Omm."}),"\n",(0,i.jsxs)(t.p,{children:["sICX and bOMM holders have ICX voting power, which they can ",(0,i.jsx)(t.a,{href:"/vote-validators",children:"delegate to ICON validators"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.a,{href:"https://github.com/openmoneymarket/openmoneymarket-mono/tree/development/scripts/prep-icx-delegations",children:"delegation script"})," fetches the wallet addresses that use bOMM to vote for a specific validator, and their voting power in ICX. The output is saved to a JSON file using this format:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'{\n    "hx04c8c5e5f412aa7c1986514bbbef2d269a2733fc": 466204891016976169228621,\n    "hx989fa78200b23ca042e52e370128ee141187f443": 438638739301371746761613,\n    "hx1be60841025db1b22126ba08ba519326603029c9": 342672743228696263962315,\n    "hx5933fba534f5152ab435e02f7067e4729affa92e": 250278905329592107143901,\n    "hx90899b65c16139ad4983a7a570c17db84c5162c4": 217572371437773081042390,\n    "hx1747aeab5afbdabd85af027ae249897cd5165146": 199561909138062903960000,\n    "hxa777652bb82b6e6a88678f2b5ccda93e3163ebc2": 156338462634667962819797\n}\n'})}),"\n",(0,i.jsx)(t.h2,{id:"run-the-icx-delegation-script",children:"Run the ICX delegation script"}),"\n",(0,i.jsx)(t.p,{children:"First, make sure you have Python 3 and PIP installed on your device. Then:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Install the required libraries:"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"pip3 install -r requirements.txt"})}),"\n",(0,i.jsxs)(t.ol,{start:"2",children:["\n",(0,i.jsx)(t.li,{children:"Run the script to fetch a list of wallet addresses and their voting power for a specific validator (also known as a P-Rep):"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"python3 prep-icx-delegations.py -prep PREP_ADDRESS\npython3 prep-icx-delegations.py -prep hx0000000000000000000000000000000000000000\n"})}),"\n",(0,i.jsxs)(t.ol,{start:"3",children:["\n",(0,i.jsxs)(t.li,{children:["Open the ",(0,i.jsx)(t.code,{children:"timestamp_prepaddress_delegations.json"})," file the script created, then divide the number beside each wallet address by 1,000,000,000,000,000,000 (10^18) to get the ICX amount."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"verify-the-votes",children:"Verify the votes"}),"\n",(0,i.jsx)(t.p,{children:"Community trackers don't pick up the votes cast with bOMM, because the votes are routed through the staking contract before they're assigned to a validator."}),"\n",(0,i.jsxs)(t.p,{children:["To verify how much ICX the ",(0,i.jsx)(t.a,{href:"https://tracker.icon.community/contract/cx43e2eec79eb76293c298f2b17aec06097be606e0",children:"liquid staking contract"})," has delegated to a validator via bOMM:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Go to the ",(0,i.jsx)(t.a,{href:"https://tracker.icon.community/contract/cx43e2eec79eb76293c298f2b17aec06097be606e0",children:"staking contract"}),", then click the Contract tab."]}),"\n",(0,i.jsxs)(t.li,{children:["Find ",(0,i.jsx)(t.code,{children:"getActualUserDelegationPercentage"}),", then query Omm's lending pool contract: ",(0,i.jsx)(t.code,{children:"cxfb312bbd0a244b9e7bb5794c91f4e4acc41dea94"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"Locate your validator address, then copy the hex value beside it."}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://www.rapidtables.com/convert/number/hex-to-decimal.html",children:"Convert the hex value to decimal"}),", then divide it by 1,000,000,000,000,000,000 (10^18). Save this result as ",(0,i.jsx)(t.code,{children:"percentage"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Find ",(0,i.jsx)(t.code,{children:"getUndelegatedICX"})," under the Contract tab, then ",(0,i.jsx)(t.a,{href:"https://www.rapidtables.com/convert/number/hex-to-decimal.html",children:"convert the hex value to decimal"})," and divide by 10^18. Save the value as ",(0,i.jsx)(t.code,{children:"undelegatedICX"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Calculate the ICX delegated to your validator address with ",(0,i.jsx)(t.code,{children:"(percentage \xf7 100) x undelegatedICX"})]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["You can also verify your bOMM votes from the ",(0,i.jsx)(t.a,{href:"https://app.omm.finance/#/vote/",children:"Vote page"})," if you sign in with a validator-associated wallet."]})]})}function h(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>s,a:()=>c});var i=n(7294);const r={},a=i.createContext(r);function c(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);